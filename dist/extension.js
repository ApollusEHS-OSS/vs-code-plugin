module.exports=function(t){var n={};function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:o})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(o,i,function(n){return t[n]}.bind(null,i));return o},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=2)}([function(t,n){t.exports=require("child_process")},function(t,n){t.exports=require("os")},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const o=e(3),i=e(4),r=e(5),s=e(6),a=e(7),d=e(0),l=e(13),u=e(1),c=new l.EventEmitter;n.activate=function(t){let n=o.workspace.getConfiguration("aesop").get("port"),e=o.workspace.getConfiguration("aesop").get("host");o.window.showInformationMessage(`Port set by default to ${n}`);const l={linux:{cmd:"netstat",args:["-apntu"]},darwin:{cmd:"netstat",args:["-v","-n","-p","tcp"]},win32:{cmd:"netstat.exe",args:["-a","-n","-o"]}}[u.platform()];o.commands.executeCommand("setContext","aesop-awake",!0);const p=o.window.createStatusBarItem(o.StatusBarAlignment.Left,7);p.text="Aesop is finding your Storybook dependency...",p.color="#FFFFFF",p.command=void 0,p.tooltip="Aesop status";let f=o.commands.registerCommand("extension.aesopAwaken",()=>{let t=!1,e=!1;const f=i.fileURLToPath(o.workspace.workspaceFolders[0].uri.toString(!0));s.access(r.join(f,"/node_modules/@storybook"),i=>{i?o.window.showErrorMessage(`Aesop could not find Storybook as a dependency in the active folder, ${f}`):(p.show(),!1===t&&a.lookup({command:"node",psargs:"ux"},(i,a)=>{i?(o.window.showErrorMessage(`Failed looking for running Node processes. Error: ${i}`),p.dispose()):(p.text="Reviewing Node processes...",a.forEach(t=>{if(s.writeFile(r.join(f,"YOLO.txt"),"Attempted launch log:\n",t=>{console.log(`Couldn't output process information to YOLO.txt: ${t}`)}),t.arguments[0].includes("storybook")){const o=t.arguments.indexOf("-p"),i=parseInt(t.pid).toString();if(-1!==o)n=parseInt(t.arguments[o+1]);else{const t=d.spawn(l.cmd,l.args),e=d.spawn("grep",[i]);t.stdout.pipe(e.stdin),e.stdout.setEncoding("utf8"),e.stdout.on("data",t=>{const e=t.split(/\s/).filter(String);n=parseInt(e[3].replace(/[^0-9]/g,"")),c.emit("sb_on")})}e=!0,p.text="Retrieving running Storybook process...",c.emit("sb_on"),s.appendFile(r.join(f,"YOLO.txt"),`This process matches for 'storybook':\n\n\t\t\t\t\t\t\t\t\tPID: ${t.pid}, COMMAND:${t.command}, ARGUMENTS: ${t.arguments}\n\n\t\t\t\t\t\t\t\t\tPORT has been assigned to: ${n}`,t=>{console.log(t)})}}),t=!0,!0===t&&!1===e&&s.readFile(r.join(f,"package.json"),(t,e)=>{if(t)o.window.showErrorMessage(`Aesop is attempting to read ${f}. Is there a package.json file here?`),p.dispose();else{p.text="Checking package.json...",p.show();let t=JSON.parse(e.toString()).scripts.storybook;s.appendFile(r.join(f,"YOLO.txt"),`Here is the script for "storybook":\n\n\t\t\t\t\t\t\t\t\t\t${t}`,t=>{console.log(t)});let i=t.split(" "),a=!1;for(let t=0;t<i.length;t++)"-p"===i[t]?(n=parseInt(i[t+1]),a=!0,s.appendFile(r.join(f,"YOLO.txt"),`Port from script":\n${parseInt(i[t+1])}\n\n\t\t\t\t\t\t\t\t\t\t\t\tPort at this moment:\n${n}\n`,t=>{console.log(t)})):t===i.length-1&&!1===a&&s.appendFile(r.join(f,"YOLO.txt"),`Script found, but no port flag detected.\n\n\t\t\t\t\t\t\t\t\t\t\t\tPort when no port flag found:\n${n}\n`,t=>{console.log(t)});let l,g=u.platform();switch(o.window.showInformationMessage(`Your platform is ${g}`),g){case"win32":l="npm.cmd",o.window.showInformationMessage(`${l}`);break;default:l="npm"}o.window.showWarningMessage(`${process.cwd()}`),o.window.showInformationMessage(`${f}`);const m=d.spawn(l,["run","storybook"],{cwd:f,detached:!1,env:process.env,windowsHide:!1,windowsVerbatimArguments:!0});p.text="Done looking. Aesop will now launch Storybook in the background.",m.stdout.setEncoding("utf8");let h=0;m.stdout.on("data",t=>{let e=t.toString().split(" ");if(h+=1,3===h){for(let t=165;t<e.length;t+=1)if(e[t].includes("localhost")){const i=e[t],r=/[^0-9]/g;n=i.replace(r,""),o.window.showInformationMessage(`This is port: ${n}`);break}let t="-p";if(e.includes(t)){const i=e.indexOf(t);o.window.showInformationMessage("This is pFlagIndex: ",i),-1!==i&&(n=parseInt(e[i+1]),o.window.showInformationMessage(`Storybook is now running on port: ${n}`),c.emit("sb_on"))}}}),m.on("error",t=>{console.log(t),process.exit(1)}),m.on("close",t=>{console.log(`child process exited with code ${t}`)})}}))}))})});t.subscriptions.push(f),c.on("sb_on",()=>{o.commands.executeCommand("extension.aesopChronicle")});let g=o.commands.registerCommand("extension.aesopChronicle",()=>{p.hide(),o.window.showInformationMessage("Welcome to Aesop Storybook"),o.window.createWebviewPanel("aesop-sb","Aesop",o.ViewColumn.Beside,{enableCommandUris:!0,enableScripts:!0,portMapping:[{webviewPort:n,extensionHostPort:n}],localResourceRoots:[o.Uri.file(t.extensionPath)]}).webview.html=`\n\t\t<!DOCTYPE html>\n\t\t<html lang="en">\n\t\t\t<head>\n\t\t\t\t<meta charset="UTF-8">\n\t\t\t\t<meta name="viewport" content="width=device-width, initial-scale=1.0">\n\t\t\t\t<title>Aesop</title>\n\t\t\t\t<style>\n\t\t\t\t\thtml { width: 100%; height: 100%; min-width: 20%; min-height: 20%;}\n\t\t\t\t\tbody { display: flex; flex-flow: column nowrap; padding: 0; margin: 0; width: 100%' justify-content: center}\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t\t<iframe src="http://${e}:${n}" width="100%" height="600"></iframe>\n\t\t\t</body>\n\t\t</html>`});t.subscriptions.push(g)},n.deactivate=function(){}},function(t,n){t.exports=require("vscode")},function(t,n){t.exports=require("url")},function(t,n){t.exports=require("path")},function(t,n){t.exports=require("fs")},function(t,n,e){t.exports=e(8)},function(t,n,e){var o=e(0),i="win32"===process.platform,r=e(9),s=/(\r\n)|(\n\r)|\n|\r/,a=e(1).EOL,d=t.exports=n=function(t,n){var e=o.spawn;if(i){var r=e("cmd"),d="",l=null;r.stdout.on("data",(function(t){d+=t.toString()})),r.stderr.on("data",(function(t){null===l?l=t.toString():l+=t.toString()})),r.on("exit",(function(){var t;(d=d.split(s)).forEach((function(n,e){n&&void 0===t&&0===n.indexOf("CommandLine")&&(t=e)})),d.splice(d.length-1,1),d.splice(0,t),n(l,d.join(a)||!1)})),r.stdin.write("wmic process get ProcessId,ParentProcessId,CommandLine \n"),r.stdin.end()}else{"string"==typeof t&&(t=t.split(/\s+/));const o=e("ps",t);d="",l=null;o.stdout.on("data",(function(t){d+=t.toString()})),o.stderr.on("data",(function(t){null===l?l=t.toString():l+=t.toString()})),o.on("exit",(function(){if(l)return n(l.toString());n(null,d||!1)}))}};n.lookup=function(t,n){var e,o=t.psargs||["lx"],i={};return t.pid&&(e=(e=Array.isArray(t.pid)?t.pid:[t.pid]).map((function(t){return String(t)}))),t.command&&(i.command=new RegExp(t.command,"i")),t.arguments&&(i.arguments=new RegExp(t.arguments,"i")),t.ppid&&(i.ppid=new RegExp(t.ppid)),d(o,(function(t,o){if(t)return n(t);var s=function(t){if(!t)return[];return n=r.parse(t),e=[],n.forEach((function(t){var n=t.PID&&t.PID[0]||t.ProcessId&&t.ProcessId[0]||void 0,o=t.CMD||t.CommandLine||t.COMMAND||void 0,i=t.PPID&&t.PPID[0]||t.ParentProcessId&&t.ParentProcessId[0]||void 0;if(n&&o){var r=o[0],s="";o.length>1&&(s=o.slice(1)),e.push({pid:n,command:r,arguments:s,ppid:i})}})),e;var n,e}(o),a=[];s.forEach((function(t){var n,o=!0;if(!(e&&e.indexOf(String(t.pid))<0)){for(n in i)o=!!i[n].test(t[n])&&o;o&&a.push(t)}})),n(null,a)}))},n.kill=function(t,e,o){2==arguments.length&&"function"==typeof e&&(o=e,e=void 0);var i=e&&e.timeout||30;"object"==typeof e&&(e=e.signal);try{process.kill(t,e)}catch(t){return o&&o(t)}var r=0,s=null,a=!1;function d(e){n.lookup({pid:t},(function(t,n){a||(t?(clearTimeout(s),e&&e(t)):n.length>0?(r=r-1||0,d(e)):5===++r?(clearTimeout(s),e&&e()):d(e))}))}o&&d(o),s=o&&setTimeout((function(){a=!0,o(new Error("Kill process timeout"))}),1e3*i)}},function(t,n,e){t.exports=e(10)},function(t,n,e){var o=e(11),i=/\s/;function r(t,n,e,o){return t>e&&t<o||n>e&&n<o||t<=e&&n>=o}function s(t){var n=t.match(/"/g);if(n&&1!=n.length){var e=[],o=null,i=!1,r=!1,s=0,a=n.length%2==0?n.length:n.length-1,d=null,l=t.split("");return l.forEach((function(t,n){" "!==t?'"'===t?!1===i&&s<=a?(i=!0,s++," "===d||null===d?(r=!0,o=""):o+=t):!0===i&&(i=!1,s++,!0===r?(r=!1,e.push(o),o=null):o+=t):!1!==i||" "!==d&&null!==d?o+=t:o=t:i?o+=t:null!==o&&(e.push(o),o=null),d=t,n==l.length-1&&null!==o&&(e.push(o),o=null)})),e}return t.split(/\s+/)}t.exports.parse=function(t){var n=t.split(/(\r\n)|(\n\r)|\n|\r/),e=[],a={},d=[];n.forEach((function(t){t&&t.trim()&&e.push(t)})),e.forEach((function(t,n){if(0==n){var e=t.split(/\s+/);e.forEach((function(n,o){if(n){var i=a[n]={},r=t.indexOf(n),s=r+n.length;i.titleBegin=0==o?0:r,o==e.length-1?i.titleEnd=t.length-1:i.titleEnd=s}}))}else d[n-1]=t.split("")}));var l=o(d,(function(t){return i.test(t)?-1:1}),!0),u=[];l.domains.sort((function(t,n){return t.bounding.x-n.bounding.x})),l.domains.forEach((function(t){if(1===t.identifier){var n=!1;u.forEach((function(e){var o=t.bounding,i=o.x,s=o.x+o.w;r(i,s,e.begin,e.end)&&(n=!0,e.domains.push(t),e.begin=e.begin>i?i:e.begin,e.end=e.end<s?s:e.end)})),n||u.push({begin:t.bounding.x,end:t.bounding.x+t.bounding.w,domains:[t]})}})),u.forEach((function(t){var n=null,e=null,o=!1,i=null,s=null,d=null;for(n in a)e=a[n],t.begin>e.titleBegin&&(d=t.begin-e.titleBegin,(!s||d<i)&&(s=n,i=d)),r(t.begin,t.end,e.titleBegin,e.titleEnd)&&(o=!0,e.titleBegin=e.titleBegin>t.begin?t.begin:e.titleBegin,e.titleEnd=e.titleEnd<t.end?t.end:e.titleEnd);if(!o&&s){var l=a[s];l.titleBegin=l.titleBegin>t.begin?t.begin:l.titleBegin,l.titleEnd=l.titleEnd<t.end?t.end:l.titleEnd}}));var c=[];return e.forEach((function(t,n){if(n>0){var e={},o=null,i=null,r=null;for(o in a)i=a[o],r=t.substring(i.titleBegin,i.titleEnd+1),e[o]=s(r.trim());c.push(e)}})),c}},function(t,n,e){t.exports=e(12)},function(t,n){t.exports=function(t,n,e){if(e=e||!1,!t)throw new Error("tdArray must be provided");if(!n)throw new Error("indicator must be provided");t=JSON.parse(JSON.stringify(t));var o={},i=0,r={};t.forEach((function(i,s){i.forEach((function(a,d){var l=n(a,d,s),u=[];if(t[s-1]&&void 0!==t[s-1][d]&&u.push(r[d+"_"+(s-1)]),void 0!==i[d-1]&&u.push(r[d-1+"_"+s]),e||(t[s-1]&&void 0!==t[s-1][d-1]&&u.push(r[d-1+"_"+(s-1)]),t[s-1]&&void 0!==t[s-1][d+1]&&u.push(r[d+1+"_"+(s-1)])),u.length){var p=!1;u.forEach((function(t){if(t.identifier==l)if(p){var n=r[d+"_"+s];t.domainId!=n.domainId&&(e=t.domainId,i=n.domainId,u=o[e],c=o[i],u.identifier==c.identifier&&(c.domainId=u.domainId,c.points.forEach((function(t){t.domainId=u.domainId,r[t.x+"_"+t.y].domainId=u.domainId})),u.points=u.points.concat(c.points),delete o[i]))}else!function(t,n,e,i){var s=o[i],a={value:t,x:n,y:e,identifier:s.identifier,domainId:i};r[n+"_"+e]={value:t,identifier:s.identifier,domainId:i},s.points.push(a)}(a,d,s,t.domainId),p=!0;var e,i,u,c})),p||c(a,d,s,l)}else c(a,d,s,l)}))}));var s={domains:[],totalDomains:0,groupByIdentifier:{},totalIdentifiers:0},a=null,d=null,l=null;for(a in o)(l=o[a]).bounding=u(l.points),d=l.identifier,s.domains.push(l),s.totalDomains++,d in s.groupByIdentifier||(s.groupByIdentifier[d]=[],s.totalIdentifiers++),s.groupByIdentifier[d].push(l);function u(t){var n=null,e=null,o=null,i=null;return t.forEach((function(t){(null===n||t.x<n)&&(n=t.x),(null===e||t.y<e)&&(e=t.y),(null===o||t.x>o)&&(o=t.x),(null===i||t.y>i)&&(i=t.y)})),{x:n,y:e,w:o-n,h:i-e}}function c(t,n,e,s){var a={identifier:s,domainId:++i,bounding:{},points:[]},d={value:t,x:n,y:e,identifier:s,domainId:a.domainId};r[n+"_"+e]={value:t,identifier:s,domainId:a.domainId},a.points.push(d),o[a.domainId]=a}return s}},function(t,n){t.exports=require("events")}]);
//# sourceMappingURL=extension.js.map